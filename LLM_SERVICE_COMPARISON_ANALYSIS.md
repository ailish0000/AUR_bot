# üìä –ê–Ω–∞–ª–∏–∑ —É–ø—Ä–æ—â–µ–Ω–∏—è LLM Service

## üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞

### –°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª: `enhanced_llm.py` (960 —Å—Ç—Ä–æ–∫)
### –ù–æ–≤—ã–π —Ñ–∞–π–ª: `frontend/services/llm_service.py` (185 —Å—Ç—Ä–æ–∫)

---

## ‚úÇÔ∏è –ß–¢–û –ë–´–õ–û –£–ü–†–û–©–ï–ù–û

### 1. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** (–£–ø—Ä–æ—â–µ–Ω–æ ‚úÇÔ∏è)

**–°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª**: 6 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ `Intent.PRODUCT_SELECTION` - ~60 —Å—Ç—Ä–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
- ‚úÖ `Intent.PRODUCT_INQUIRY` - ~30 —Å—Ç—Ä–æ–∫
- ‚úÖ `Intent.COMPOSITION_INQUIRY` - ~15 —Å—Ç—Ä–æ–∫
- ‚úÖ `Intent.COMPLAINT` - ~15 —Å—Ç—Ä–æ–∫
- ‚úÖ `Intent.GENERAL_QUESTION` - ~35 —Å—Ç—Ä–æ–∫
- ‚úÖ `Intent.PRODUCT_COMPARISON` - ~35 —Å—Ç—Ä–æ–∫

**–ù–æ–≤—ã–π —Ñ–∞–π–ª**: 1 —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç (~20 —Å—Ç—Ä–æ–∫)

**–ü–æ—Ç–µ—Ä–∏**: 
- ‚ùå –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞
- ‚ùå –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–æ–≤
- ‚ùå –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚ùå –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø—Ä–æ—Ç–∏–≤–æ–≤–∏—Ä—É—Å–Ω—ã—Ö, –∫–æ–ª–ª–∞–≥–µ–Ω–∞, —Å–æ—Ä–±–µ–Ω—Ç–æ–≤ –∏ —Ç.–¥.

---

### 2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏** (–£–ø—Ä–æ—â–µ–Ω–æ ‚úÇÔ∏è)

**–°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª**:
```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
- enhanced_search_engine (—É—Å–∏–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫)
- smart_search (SmartSearchEngine)
- smart_nlp (SmartNLPParser)
- enhanced_vector_db (–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î)
```

**–ù–æ–≤—ã–π —Ñ–∞–π–ª**:
```python
# –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π –≤—ã–∑–æ–≤ search_service
```

**–ü–æ—Ç–µ—Ä–∏**:
- ‚ùå –£–º–Ω—ã–π –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫
- ‚ùå NLP –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Qdrant
- ‚ùå –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–∏—Å–∫–∞

---

### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤** (–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–µ–Ω–æ ‚úÇÔ∏è)

**–°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª** (`process_query`):
```python
1. Small-talk –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è)
2. –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
4. NLP –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ nlp_processor
5. –£—Å–∏–ª–µ–Ω–Ω—ã–π –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫ (8 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
6. Fallback –∫ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ –ø–æ–∏—Å–∫–∞
7. –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º (entities)
8. –ü–æ–∏—Å–∫ –ø–æ —Å–ª—É—á–∞—é –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (use_case)
9. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ Enhanced vs Smart Search
10. Fallback –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –ø–æ–∏—Å–∫—É –≤ knowledge_base.json
11. –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∞–ª–æ–±
12. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã"
13. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫ LLM
14. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
```

**–ù–æ–≤—ã–π —Ñ–∞–π–ª** (`process_query`):
```python
1. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫ LLM
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```

**–ü–æ—Ç–µ—Ä–∏**:
- ‚ùå –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ —Å fallback
- ‚ùå Small-talk –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚ùå –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞
- ‚ùå NLP –∞–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏–π
- ‚ùå –î–µ—Ç–µ–∫—Ü–∏—è "–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã"

---

### 4. **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** (–£–ø—Ä–æ—â–µ–Ω–æ ‚úÇÔ∏è)

**–°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª** (`_build_context`):
```python
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
- –¢–∏–ø –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (chunk_type)
- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (score)
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ)
- –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è LLM
```

**–ù–æ–≤—ã–π —Ñ–∞–π–ª** (`_build_context`):
```python
- –ü—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –ù–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –æ–ø–∏—Å–∞–Ω–∏–µ
```

**–ü–æ—Ç–µ—Ä–∏**:
- ‚ùå –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚ùå –¢–∏–ø—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (benefits, composition, dosage)
- ‚ùå –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- ‚ùå –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

### 5. **–°–∏–Ω–æ–Ω–∏–º—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤** (–£–¥–∞–ª–µ–Ω–æ ‚úÇÔ∏è)

**–°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª**:
```python
OMEGA_SYNONYMS = [
    "–æ–º–µ–≥–∞-3", "–æ–º–µ–≥–∞ 3", "—Ä—ã–±–∏–π –∂–∏—Ä", "–ø–Ω–∂–∫", "—ç–ø–∫", "–¥–≥–∫", ...
]

MAGNESIUM_SYNONYMS = [
    "–º–∞–≥–Ω–∏–π", "–º–∞–≥–Ω–∏—è", "–º–∞–≥–Ω–∏–µ–º", "magnesium", "mg", ...
]

def _expand_query_with_synonyms(self, query: str) -> str:
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏
```

**–ù–æ–≤—ã–π —Ñ–∞–π–ª**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–ü–æ—Ç–µ—Ä–∏**:
- ‚ùå –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–∏–Ω–æ–Ω–∏–º–∞–º
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

---

### 6. **–õ–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –≤ knowledge_base.json** (–£–¥–∞–ª–µ–Ω–æ ‚úÇÔ∏è)

**–°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª**:
```python
def _build_local_kb_context(self, expanded_query: str):
    # –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
    # –§–∏–ª—å—Ç—Ä—ã –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
    # Smart Search + Fallback

def _search_in_kb(self, kb_data, terms, source, found_products):
    # –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
    # –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ª—è –ø–æ–∏—Å–∫–∞
    # –í–µ—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è
```

**–ù–æ–≤—ã–π —Ñ–∞–π–ª**: –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Backend API

**–ü–æ—Ç–µ—Ä–∏**:
- ‚ùå –õ–æ–∫–∞–ª—å–Ω—ã–π fallback –µ—Å–ª–∏ Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- ‚ùå –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –≤ JSON —Ñ–∞–π–ª–µ
- ‚ùå –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

---

### 7. **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** (–£–¥–∞–ª–µ–Ω–æ ‚úÇÔ∏è)

**–°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª**:
```python
def _is_immunity_query(self, text: str):
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–± –∏–º–º—É–Ω–∏—Ç–µ—Ç–µ
    
def _get_search_filters(self, message: ProcessedMessage):
    # –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø—É –∑–∞–ø—Ä–æ—Å–∞
    
def _should_search_immediately(self, intent: Intent):
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞
    
def _convert_markdown_to_html(self, text: str):
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Markdown
    
def _fallback_response(self, context: str):
    # –†–µ–∑–µ—Ä–≤–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ API
```

**–ù–æ–≤—ã–π —Ñ–∞–π–ª**: –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π `_fallback_response`

**–ü–æ—Ç–µ—Ä–∏**:
- ‚ùå –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–± –∏–º–º—É–Ω–∏—Ç–µ—Ç–µ
- ‚ùå –£–º–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
- ‚ùå –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Markdown
- ‚ùå –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

---

### 8. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏** (–£–¥–∞–ª–µ–Ω–æ ‚úÇÔ∏è)

**–°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª**:
```python
from nlp_processor import nlp_processor, Intent, ProcessedMessage
from enhanced_vector_db import enhanced_vector_db, SearchResult
from enhanced_search_engine import initialize_enhanced_search
from immunity_recommendations import get_immunity_recommendation_template
from smart_nlp_parser import SmartNLPParser
from smart_search_engine import SmartSearchEngine
```

**–ù–æ–≤—ã–π —Ñ–∞–π–ª**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

**–ü–æ—Ç–µ—Ä–∏**:
- ‚ùå NLP –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚ùå –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î
- ‚ùå –£–º–Ω—ã–π –ø–æ–∏—Å–∫
- ‚ùå –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–∏–º–º—É–Ω–∏—Ç–µ—Ç)

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–û–¢–ï–†–ò –§–£–ù–ö–¶–ò–û–ù–ê–õ–ê

### üî¥ –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)

1. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –ø–æ —Ç–∏–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ü–æ—Ç–µ—Ä—è: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π
   - –í–ª–∏—è–Ω–∏–µ: –ú–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã LLM
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å –ø—Ä–æ–º–ø—Ç–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ

2. **NLP –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π**
   - –ü–æ—Ç–µ—Ä—è: –ê–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Intent)
   - –í–ª–∏—è–Ω–∏–µ: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –ø–æ–¥ —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞
   - –†–µ—à–µ–Ω–∏–µ: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å nlp_processor –≤ utils

3. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫**
   - –ü–æ—Ç–µ—Ä—è: Enhanced Search + Smart Search + Fallback
   - –í–ª–∏—è–Ω–∏–µ: –ú–µ–Ω–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
   - –†–µ—à–µ–Ω–∏–µ: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤ search_service

4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤**
   - –ü–æ—Ç–µ—Ä—è: –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –í–ª–∏—è–Ω–∏–µ: –ë–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API, –º–µ–¥–ª–µ–Ω–Ω–µ–µ
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å cache_service

5. **–õ–æ–∫–∞–ª—å–Ω—ã–π fallback**
   - –ü–æ—Ç–µ—Ä—è: –ü–æ–∏—Å–∫ –≤ knowledge_base.json
   - –í–ª–∏—è–Ω–∏–µ: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Backend API
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –≤ search_service

---

### üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)

6. **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤**
   - –ü–æ—Ç–µ—Ä—è: –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (–ø—Ä–æ—Ç–∏–≤–æ–≤–∏—Ä—É—Å–Ω—ã–µ, –∫–æ–ª–ª–∞–≥–µ–Ω –∏ —Ç.–¥.)
   - –í–ª–∏—è–Ω–∏–µ: –ú–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –≤ prompt_templates.py

7. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏**
   - –ü–æ—Ç–µ—Ä—è: OMEGA_SYNONYMS, MAGNESIUM_SYNONYMS
   - –í–ª–∏—è–Ω–∏–µ: –•—É–∂–µ –ø–æ–∏—Å–∫ –ø–æ —Å–∏–Ω–æ–Ω–∏–º–∞–º
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –≤ utils/synonyms.py

8. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∞–ª–æ–± –∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–π —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**
   - –ü–æ—Ç–µ—Ä—è: –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ complaint
   - –í–ª–∏—è–Ω–∏–µ: –ú–µ–Ω–µ–µ —ç–º–ø–∞—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å sentiment analysis

---

### üü¢ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ)

9. **Small-talk –æ–±—Ä–∞–±–æ—Ç–∫–∞**
   - –ü–æ—Ç–µ—Ä—è: –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
   - –í–ª–∏—è–Ω–∏–µ: –í—Å–µ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ LLM
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å simple_responses.py

10. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Markdown**
    - –ü–æ—Ç–µ—Ä—è: _convert_markdown_to_html
    - –í–ª–∏—è–Ω–∏–µ: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
    - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –≤ utils/formatters.py

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –£–ü–†–û–©–ï–ù–ò–Ø

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ä—ã–π | –ù–æ–≤—ã–π | –ü–æ—Ç–µ—Ä—è |
|-----------|--------|-------|--------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | 960 | 185 | -81% |
| –°–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ | 6 | 1 | -83% |
| –ú–µ—Ç–æ–¥–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ | 20+ | 5 | -75% |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π | 6 | 1 | -83% |
| –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ | 10+ | 1 | -90% |

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Æ

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ‚ö†Ô∏è

```python
# 1. –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
frontend/services/prompt_templates.py
- –í—Å–µ 6 –ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∞–π–ª–∞
- –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞ –ø–æ –Ω–∞–º–µ—Ä–µ–Ω–∏—é

# 2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å NLP –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä
frontend/utils/nlp_processor.py
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π (Intent)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (ProcessedMessage)
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

# 3. –£–ª—É—á—à–∏—Ç—å search_service
frontend/services/search_service.py
- –î–æ–±–∞–≤–∏—Ç—å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π fallback
- –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ

# 4. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
frontend/services/cache_service.py
- –ö—ç—à –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- TTL (time to live)
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞
```

### –§–∞–∑–∞ 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª üîß

```python
# 5. –°–∏–Ω–æ–Ω–∏–º—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
frontend/utils/synonyms.py
- OMEGA_SYNONYMS
- MAGNESIUM_SYNONYMS
- expand_query_with_synonyms()

# 6. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
frontend/utils/special_handlers.py
- is_immunity_query()
- is_small_talk()
- detect_all_options_request()

# 7. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
frontend/utils/formatters.py
- convert_markdown_to_html()
- format_response()
- limit_response_length()
```

---

## ‚úÖ –ß–¢–û –°–û–•–†–ê–ù–ï–ù–û –ü–†–ê–í–ò–õ–¨–ù–û

1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞
2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenRouter/OpenAI
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
4. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5. ‚úÖ Async/await –ø–∞—Ç—Ç–µ—Ä–Ω
6. ‚úÖ Dataclass –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
7. ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º (–±–∞–∑–æ–≤—ã–π)

---

## üéØ –í–´–í–û–î

### –ß—Ç–æ –º—ã –ø–æ—Ç–µ—Ä—è–ª–∏:
**–ú—ã —É–ø—Ä–æ—Å—Ç–∏–ª–∏ —Ñ–∞–π–ª –Ω–∞ 81%, –Ω–æ –ø–æ—Ç–µ—Ä—è–ª–∏ ~75% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞!**

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å:
- üî¥ **–í—ã—Å–æ–∫–∞—è** (5 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤) - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
- üü° **–°—Ä–µ–¥–Ω—è—è** (3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞) - –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
- üü¢ **–ù–∏–∑–∫–∞—è** (2 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞) - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–ø—Ä–æ—â–µ–Ω–∏—è:
- ‚úÖ –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–Ω—è—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ —É–ø—Ä–æ—â–µ–Ω–∏—è:
- ‚ùå –ü–æ—Ç–µ—Ä—è 75% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ‚ùå –ú–µ–Ω–µ–µ —É–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- ‚ùå –•—É–∂–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞
- ‚ùå –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Backend

---

## üöÄ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–∫—Ä–∏—Ç–∏—á–Ω–æ):
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (prompt_templates.py)
2. –î–æ–±–∞–≤–∏—Ç—å NLP –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (nlp_processor.py)
3. –£–ª—É—á—à–∏—Ç—å search_service (–º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫)
4. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (cache_service.py)

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:
5. –î–æ–±–∞–≤–∏—Ç—å —Å–∏–Ω–æ–Ω–∏–º—ã (synonyms.py)
6. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (special_handlers.py)
7. Sentiment analysis –¥–ª—è –∂–∞–ª–æ–±

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
8. Small-talk –æ–±—Ä–∞–±–æ—Ç–∫–∞
9. Markdown –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
10. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç–µ—Ä—ã

---

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–ø—É–Ω–∫—Ç—ã 1-4) –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production!

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-10-28  
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞
